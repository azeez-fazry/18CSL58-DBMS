/*
	EMPLOYEE (SSN, Name, Address, Sex, Salary, SuperSSN, DNo) DEPARTMENT (DNo, DName, MgrSSN, MgrStartDate)
	DLOCATION (DNo,DLoc)
	PROJECT (PNo, PName, PLocation, DNo) 
	WORKS_ON (SSN, PNo, Hours)
	
	Write SQL queries to
	
	1. 	Make a list of all project numbers for projects that involve an employee
		whose last name is 'Scott’, either as a worker or as a manager of the
		department that controls the project.
	
	2. 	Show the resulting salaries if every employee working on the 'IoT’ project is
		given a 10 percentraise.
	
	3. 	Find the sum of the salaries of all employees of the 'Accounts’ department,
		as well as the maximum salary, the minimum salary, and the average salary
		in this department
	
	4. 	Retrieve the name of each employee who works on all the projects
		controlled by department number 5 (use NOT EXISTS operator). For each
		department that has more than five employees, retrieve the department
		number and the number of its employees who are making more than
		Rs.6,00,000.
*/

DROP DATABASE IF EXISTS LAB5;
CREATE DATABASE LAB5;
USE LAB5;

DROP TABLE IF EXISTS DEPARTMENT; 
CREATE TABLE DEPARTMENT (
	DNO VARCHAR (20) PRIMARY KEY,
	DNAME VARCHAR (20), 
	MGRSTARTDATE DATE,
	MGRSSN VARCHAR (20)
);

DROP TABLE IF EXISTS EMPLOYEE; 
CREATE TABLE EMPLOYEE (
	SSN VARCHAR (20) PRIMARY KEY,
	FNAME VARCHAR(20),
	LNAME VARCHAR(20),
	ADDRESS VARCHAR (20),
	SEX CHAR (1), 
	SALARY DECIMAL (10,2),
	SUPERSSN VARCHAR (20),
	DNO VARCHAR (20)
);

DROP TABLE IF EXISTS DLOCATION; 
CREATE TABLE DLOCATION (
	DLOC VARCHAR (20),
	DNO VARCHAR (20),
	PRIMARY KEY (DNO, DLOC)
);

DROP TABLE IF EXISTS PROJECT; 
CREATE TABLE PROJECT (
	PNO BIGINT (10) PRIMARY KEY, 
	PNAME VARCHAR(20),
	PLOCATION VARCHAR (20),
	DNO VARCHAR (20)
);

DROP TABLE IF EXISTS WORKS_ON; 
CREATE TABLE WORKS_ON (
	HOURS BIGINT (2),
	SSN VARCHAR (20),
	PNO BIGINT (10),
	PRIMARY KEY (SSN, PNO)
);

INSERT INTO DEPARTMENT VALUES ('1','ACCOUNTS','2001-01-01','RNSACC02'); 
INSERT INTO DEPARTMENT VALUES ('2','IT','2016-08-01','RNSIT01');
INSERT INTO DEPARTMENT VALUES ('3','ECE','2008-06-01','RNSECE01'); 
INSERT INTO DEPARTMENT VALUES ('4','ISE','2015-08-01','RNSISE01'); 
INSERT INTO DEPARTMENT VALUES ('5','CSE','2002-06-01','RNSCSE05');

INSERT INTO EMPLOYEE VALUES ('RNSECE01','JOHN','SCOTT','BANGALORE','M', 450000,NULL,'3');
INSERT INTO EMPLOYEE VALUES ('RNSCSE01','JAMES','SMITH','BANGALORE','M', 500000,'RNSCSE01','5');
INSERT INTO EMPLOYEE VALUES ('RNSCSE02','HEARN','BAKER','BANGALORE','M', 700000,'RNSCSE03','5');
INSERT INTO EMPLOYEE VALUES ('RNSCSE03','EDWARD','SCOTT','MYSORE','M', 500000,'RNSCSE04','5');
INSERT INTO EMPLOYEE VALUES ('RNSCSE04','PAVAN','HEGDE','MANGALORE','M', 650000,'RNSCSE05','5');
INSERT INTO EMPLOYEE VALUES ('RNSCSE05','GIRISH','MALYA','MYSORE','M', 450000,'RNSCSE06','5');
INSERT INTO EMPLOYEE VALUES ('RNSCSE06','NEHA','SN','BANGALORE','F', 800000,NULL,'5');
INSERT INTO EMPLOYEE VALUES ('RNSACC01','AHANA','K','MANGALORE','F', 350000,'RNSACC02','1');
INSERT INTO EMPLOYEE VALUES ('RNSACC02','SANTHOSH','KUMAR','MANGALORE','M', 300000,NULL,'1');
INSERT INTO EMPLOYEE VALUES ('RNSISE01','VEENA','M','MYSORE','M', 600000,NULL,'4');
INSERT INTO EMPLOYEE VALUES ('RNSIT01','NAGESH','HR','BANGALORE','M', 500000,NULL,'2');

INSERT INTO DLOCATION VALUES ('BANGALORE', '1');
INSERT INTO DLOCATION VALUES ('BANGALORE', '2');
INSERT INTO DLOCATION VALUES ('BANGALORE', '3');
INSERT INTO DLOCATION VALUES ('MANGALORE','4');
INSERT INTO DLOCATION VALUES ('MANGALORE','5');

INSERT INTO PROJECT VALUES (100,'IOT','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (101,'CLOUD','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (102,'BIGDATA','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (103,'SENSORS','BANGALORE','3');
INSERT INTO PROJECT VALUES (104,'BANK MANAGEMENT','BANGALORE','1'); 
INSERT INTO PROJECT VALUES (105,'SALARYMANAGEMENT','BANGALORE','1'); 
INSERT INTO PROJECT VALUES(106,'OPENSTACK','BANGALORE','4');
INSERT INTO PROJECT VALUES (107,'SMARTCITY','BANGALORE','2');

INSERT INTO WORKS_ON VALUES (4, 'RNSCSE01', 100);
INSERT INTO WORKS_ON VALUES (6, 'RNSCSE01', 101);
INSERT INTO WORKS_ON VALUES (8, 'RNSCSE01', 102);
INSERT INTO WORKS_ON VALUES (10, 'RNSCSE02', 100);
INSERT INTO WORKS_ON VALUES (3, 'RNSCSE04', 100);
INSERT INTO WORKS_ON VALUES (4, 'RNSCSE05', 101);
INSERT INTO WORKS_ON VALUES (5, 'RNSCSE06', 102);
INSERT INTO WORKS_ON VALUES (6, 'RNSCSE03', 102);
INSERT INTO WORKS_ON VALUES (7, 'RNSECE01', 103);
INSERT INTO WORKS_ON VALUES (5, 'RNSACC01', 104);
INSERT INTO WORKS_ON VALUES (6, 'RNSACC02', 105);
INSERT INTO WORKS_ON VALUES (4, 'RNSISE01', 106);
INSERT INTO WORKS_ON VALUES (10, 'RNSIT01', 107); 

ALTER TABLE DEPARTMENT
	ADD FOREIGN KEY (MGRSSN) REFERENCES EMPLOYEE (SSN);
	
ALTER TABLE EMPLOYEE
	ADD FOREIGN KEY (SUPERSSN) REFERENCES EMPLOYEE (SSN),
	ADD FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO);
	
ALTER TABLE DLOCATION
	ADD FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO);
	
ALTER TABLE PROJECT
	ADD FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO);
	
ALTER TABLE WORKS_ON
	ADD FOREIGN KEY (PNO) REFERENCES PROJECT (PNO),
	ADD FOREIGN KEY (SSN) REFERENCES EMPLOYEE (SSN);
